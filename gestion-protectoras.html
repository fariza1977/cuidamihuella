<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Gestión - CuidaMiHuella</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fdf2f8; color: #374151; }
        .btn-primary { background-color: #8b5cf6; color: white; }
        .btn-primary:hover { background-color: #7c3aed; }
        .card-animal { transition: all 0.3s; }
        .card-animal:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .file-upload { border: 2px dashed #cbd5e1; transition: all 0.3s; }
        .file-upload:hover { border-color: #8b5cf6; background-color: #f5f3ff; }
        /* Estilos para el Modal */
        .modal { transition: opacity 0.3s ease-in-out; }
        .modal-content { transition: transform 0.3s ease-in-out; }
        /* Fondo Huellas Suave para el Panel */
        body {
            background-image: linear-gradient(rgba(253, 242, 248, 0.95), rgba(253, 242, 248, 0.95)), url('imagen2.jpg');
            background-size: cover;
            background-attachment: fixed;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 h-20 flex items-center justify-between">
            <a href="index.html" class="flex items-center space-x-2 text-2xl font-bold text-violet-800">
                <i class="fas fa-paw text-violet-500"></i><span>CuidaMiHuella</span>
            </a>
            <div class="flex items-center space-x-4">
                <span id="user-badge" class="hidden md:inline-block bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-bold border border-green-200">
                    <i class="fas fa-check-circle mr-1"></i> Protectora Verificada
                </span>
                <a href="para-protectoras.html" class="text-sm text-gray-500 hover:text-violet-600 font-bold">Salir al Portal Público</a>
            </div>
        </div>
    </header>

    <main class="flex-grow">
        <!-- LOGIN SCREEN (Visible si no estás logueado) -->
        <div id="login-screen" class="flex items-center justify-center py-20 px-4 min-h-[80vh]">
            <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full border-t-4 border-violet-500">
                <div class="text-center mb-8">
                    <div class="inline-block p-4 rounded-full bg-violet-100 mb-4">
                        <i class="fas fa-user-shield text-4xl text-violet-600"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">Acceso Privado</h1>
                    <p class="text-gray-500 text-sm mt-2">Introduce tus credenciales de Protectora.</p>
                </div>
                <form id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Email</label>
                        <input type="email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent outline-none" placeholder="protectora@ejemplo.com">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Contraseña</label>
                        <input type="password" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent outline-none" placeholder="••••••••">
                    </div>
                    <button type="submit" class="w-full btn-primary py-3 rounded-lg font-bold text-lg shadow-md hover:shadow-lg transition">Entrar al Panel</button>
                </form>
                <p class="text-center text-xs text-gray-400 mt-6 italic">* Demo: Usa cualquier email y contraseña para probar.</p>
            </div>
        </div>

        <!-- DASHBOARD (Visible solo tras login) -->
        <div id="dashboard" class="hidden container mx-auto px-4 py-8">
            
            <div class="flex justify-between items-end mb-8 border-b border-violet-200 pb-4">
                <div>
                    <h2 class="text-3xl font-bold text-violet-900">Gestión de Animales</h2>
                    <p class="text-gray-600">Sube, edita o elimina las fichas de tus animales en adopción.</p>
                </div>
                <button id="logout-btn" class="text-red-500 hover:text-red-700 font-medium text-sm underline flex items-center">
                    <i class="fas fa-sign-out-alt mr-2"></i> Cerrar Sesión
                </button>
            </div>

            <!-- Formulario de Alta -->
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-12 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-2 h-full bg-violet-500"></div>
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-violet-100 text-violet-600 p-2 rounded-lg mr-3"><i class="fas fa-plus"></i></span>
                    Publicar Nuevo Animal
                </h3>
                
                <form id="add-animal-form" class="grid grid-cols-1 md:grid-cols-12 gap-8">
                    
                    <!-- Foto Upload -->
                    <div class="md:col-span-4">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Fotografía Principal</label>
                        <div class="file-upload relative h-64 rounded-lg bg-gray-50 flex flex-col items-center justify-center overflow-hidden border-2 border-dashed border-violet-200 hover:border-violet-500 transition-colors group">
                            <input type="file" id="photo-input" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                            <div id="upload-ui" class="text-center p-4 group-hover:scale-105 transition-transform">
                                <i class="fas fa-cloud-upload-alt text-5xl text-violet-300 mb-3"></i>
                                <p class="text-sm text-gray-600 font-medium">Arrastra o haz clic</p>
                                <p class="text-xs text-gray-400">JPG, PNG (Max 5MB)</p>
                            </div>
                            <img id="photo-preview" class="hidden absolute inset-0 w-full h-full object-cover z-0">
                        </div>
                    </div>

                    <!-- Datos del Animal -->
                    <div class="md:col-span-8 grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="md:col-span-2">
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Nombre</label>
                            <input type="text" id="animal-name" required class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none transition" placeholder="Ej: Max">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Raza / Tipo</label>
                            <input type="text" id="animal-breed" placeholder="Ej: Labrador" required class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none transition">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Edad</label>
                            <input type="text" id="animal-age" placeholder="Ej: 2 años" required class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none transition">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Estado de Salud / Vacunas</label>
                            <input type="text" id="animal-health" placeholder="Ej: Vacunado, chip, desparasitado y esterilizado" class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none transition">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Descripción / Carácter</label>
                            <textarea id="animal-desc" rows="3" placeholder="Describe su personalidad, historia y necesidades..." class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none transition"></textarea>
                        </div>
                        <div class="md:col-span-2 pt-2">
                            <button type="submit" class="w-full btn-primary py-4 rounded-xl font-bold shadow-lg hover:shadow-xl transition transform hover:-translate-y-1 flex justify-center items-center">
                                <i class="fas fa-save mr-2"></i> Publicar Ficha
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Grid de Animales -->
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Mis Animales Publicados</h3>
                <span class="bg-violet-100 text-violet-800 text-xs font-bold px-3 py-1 rounded-full" id="animal-count">0 Animales</span>
            </div>
            
            <div id="animals-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Las tarjetas se generan aquí -->
            </div>
            
             <div id="empty-state" class="hidden text-center py-16 bg-white/80 backdrop-blur-sm rounded-xl border-2 border-dashed border-gray-300">
                <div class="bg-gray-100 p-4 rounded-full inline-block mb-4">
                    <i class="fas fa-paw text-4xl text-gray-400"></i>
                </div>
                <h4 class="text-xl font-bold text-gray-600">Aún no has subido ningún animal</h4>
                <p class="text-gray-500 mt-2">Utiliza el formulario de arriba para crear tu primera ficha.</p>
            </div>

        </div>
    </main>

    <!-- MODAL DE INTERESADOS (El Ojo) -->
    <div id="visitors-modal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
        <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden transform scale-95 opacity-0 transition-all duration-300">
            <div class="bg-violet-600 p-5 flex justify-between items-center text-white">
                <h3 class="font-bold text-lg flex items-center"><i class="fas fa-heart mr-2"></i> Interesados en <span id="modal-animal-name" class="ml-1 underline decoration-dotted"></span></h3>
                <button onclick="closeModal()" class="hover:bg-violet-700 rounded-full w-8 h-8 flex items-center justify-center transition">&times;</button>
            </div>
            <div class="p-0 max-h-[60vh] overflow-y-auto bg-gray-50" id="visitors-list">
                <!-- Lista simulada -->
                <div class="p-4 border-b border-gray-200 bg-white flex items-center justify-between hover:bg-gray-50 transition cursor-pointer">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-bold shadow">JP</div>
                        <div>
                            <p class="font-bold text-gray-800 text-sm">Juan Pérez</p>
                            <p class="text-xs text-green-600 font-semibold"><i class="fas fa-check-circle"></i> Socio Amigo Verificado</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <button class="text-xs bg-violet-100 text-violet-700 px-2 py-1 rounded hover:bg-violet-200">Contactar</button>
                        <p class="text-[10px] text-gray-400 mt-1">Hace 2h</p>
                    </div>
                </div>
                
                <div class="p-4 border-b border-gray-200 bg-white flex items-center justify-between hover:bg-gray-50 transition cursor-pointer">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-pink-600 flex items-center justify-center text-white font-bold shadow">MG</div>
                        <div>
                            <p class="font-bold text-gray-800 text-sm">María García</p>
                            <p class="text-xs text-gray-500">Usuario Nuevo</p>
                        </div>
                    </div>
                     <div class="text-right">
                        <button class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded hover:bg-gray-200">Ver Perfil</button>
                        <p class="text-[10px] text-gray-400 mt-1">Hace 5h</p>
                    </div>
                </div>
                
                <div class="p-6 text-center">
                    <p class="text-sm text-gray-400 italic">No hay más interesados recientes.</p>
                </div>
            </div>
            <div class="p-4 bg-white border-t border-gray-200 text-center">
                <button onclick="closeModal()" class="w-full py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-bold transition">Cerrar Ventana</button>
            </div>
        </div>
    </div>

    <footer class="bg-white border-t py-8 mt-auto text-center text-gray-600">
        <div class="container mx-auto">
            <p class="mb-2 font-bold text-violet-800">Panel de Gestión CuidaMiHuella</p>
            <p class="text-xs">© 2025 Uso exclusivo para protectoras autorizadas.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginScreen = document.getElementById('login-screen');
            const dashboard = document.getElementById('dashboard');
            const animalsGrid = document.getElementById('animals-grid');
            const photoInput = document.getElementById('photo-input');
            const photoPreview = document.getElementById('photo-preview');
            const uploadUi = document.getElementById('upload-ui');
            const emptyState = document.getElementById('empty-state');
            const animalCount = document.getElementById('animal-count');
            
            // Datos simulados iniciales (si no hay nada en memoria)
            let animals = JSON.parse(localStorage.getItem('ch_animals')) || [
                {id: 1, name: 'Toby', breed: 'Mestizo', age: '3 años', health: 'Sano, vacunado', desc: 'Es un perro muy cariñoso, le encantan los niños.', photo: 'https://images.unsplash.com/photo-1543466835-00a7907e9de1?auto=format&fit=crop&w=400&q=80'}
            ];

            // 1. LÓGICA DE LOGIN (Persistencia simple)
            if(localStorage.getItem('ch_logged_in') === 'true') {
                showDashboard();
            }

            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                localStorage.setItem('ch_logged_in', 'true');
                showDashboard();
            });

            document.getElementById('logout-btn').addEventListener('click', () => {
                localStorage.removeItem('ch_logged_in');
                location.reload(); // Recargar para volver al login
            });

            function showDashboard() {
                loginScreen.classList.add('hidden');
                dashboard.classList.remove('hidden');
                renderAnimals();
            }

            // 2. PREVIEW DE FOTO
            photoInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        photoPreview.src = e.target.result;
                        photoPreview.classList.remove('hidden');
                        uploadUi.classList.add('hidden');
                    }
                    reader.readAsDataURL(file);
                }
            });

            // 3. AÑADIR ANIMAL
            document.getElementById('add-animal-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                // Crear objeto animal
                const newAnimal = {
                    id: Date.now(),
                    name: document.getElementById('animal-name').value,
                    breed: document.getElementById('animal-breed').value,
                    age: document.getElementById('animal-age').value,
                    health: document.getElementById('animal-health').value,
                    desc: document.getElementById('animal-desc').value,
                    // Usar la imagen previsualizada o un placeholder si no hay
                    photo: photoPreview.src && !photoPreview.classList.contains('hidden') ? photoPreview.src : 'https://placehold.co/400x300/e2e8f0/64748b?text=Sin+Foto'
                };
                
                // Guardar
                animals.unshift(newAnimal);
                localStorage.setItem('ch_animals', JSON.stringify(animals));
                
                // Resetear formulario
                e.target.reset();
                photoPreview.src = '';
                photoPreview.classList.add('hidden');
                uploadUi.classList.remove('hidden');
                
                renderAnimals();
                alert('¡Ficha de ' + newAnimal.name + ' publicada con éxito!');
            });

            // 4. MODAL DE VISITANTES (EL OJO)
            const modal = document.getElementById('visitors-modal');
            const modalContent = modal.querySelector('.modal-content');
            
            window.viewVisitors = (name) => {
                document.getElementById('modal-animal-name').textContent = name;
                modal.classList.remove('hidden');
                // Pequeño delay para la animación
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            };

            window.closeModal = () => {
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            };
            
            // Cerrar modal al hacer clic fuera
            modal.addEventListener('click', (e) => {
                if(e.target === modal) closeModal();
            });

            // 5. BORRAR ANIMAL
            window.deleteAnimal = (id) => {
                if(confirm('¿Seguro que quieres eliminar esta ficha? Esta acción es irreversible.')) {
                    animals = animals.filter(a => a.id !== id);
                    localStorage.setItem('ch_animals', JSON.stringify(animals));
                    renderAnimals();
                }
            };

            // 6. RENDERIZAR ANIMALES
            function renderAnimals() {
                animalsGrid.innerHTML = '';
                animalCount.textContent = animals.length + ' Animales';

                if(animals.length === 0) {
                    emptyState.classList.remove('hidden');
                    return;
                }
                emptyState.classList.add('hidden');

                animals.forEach(animal => {
                    const card = document.createElement('div');
                    card.className = 'card-animal bg-white rounded-xl shadow-md overflow-hidden flex flex-col relative group border border-gray-100';
                    
                    card.innerHTML = `
                        <div class="relative h-56 overflow-hidden">
                            <img src="${animal.photo}" class="w-full h-full object-cover transition duration-500 group-hover:scale-105">
                            
                            <!-- Overlay con botones de acción (Solo visibles al pasar el mouse) -->
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center space-x-4 backdrop-blur-[2px]">
                                <button onclick="viewVisitors('${animal.name}')" class="bg-white text-violet-600 w-12 h-12 rounded-full flex items-center justify-center hover:bg-violet-50 shadow-xl transition transform hover:scale-110" title="Ver Interesados">
                                    <i class="fas fa-eye text-lg"></i>
                                </button>
                                <button onclick="deleteAnimal(${animal.id})" class="bg-white text-red-500 w-12 h-12 rounded-full flex items-center justify-center hover:bg-red-50 shadow-xl transition transform hover:scale-110" title="Borrar Ficha">
                                    <i class="fas fa-trash-alt text-lg"></i>
                                </button>
                            </div>
                            
                            <span class="absolute top-3 left-3 bg-white/90 backdrop-blur-md text-gray-800 text-xs font-bold px-3 py-1 rounded-full shadow-sm">
                                ${animal.breed}
                            </span>
                        </div>
                        
                        <div class="p-5 flex-grow flex flex-col">
                            <div class="flex justify-between items-start mb-3">
                                <h4 class="text-2xl font-bold text-gray-800">${animal.name}</h4>
                                <span class="text-xs font-bold bg-green-100 text-green-700 px-2 py-1 rounded-md">${animal.age}</span>
                            </div>
                            
                            <div class="space-y-2 mb-4 flex-grow">
                                <p class="text-xs text-gray-500 flex items-center">
                                    <i class="fas fa-heartbeat w-5 text-center text-pink-400 mr-1"></i> ${animal.health}
                                </p>
                                <p class="text-sm text-gray-600 italic leading-relaxed line-clamp-3">"${animal.desc}"</p>
                            </div>
                            
                            <!-- Botón simulado de vista cliente -->
                            <div class="pt-4 border-t border-gray-100">
                                <button class="w-full py-2 bg-gray-50 text-gray-400 font-medium rounded-lg text-sm cursor-default flex items-center justify-center hover:bg-gray-100 transition">
                                    <i class="far fa-eye mr-2"></i> Vista Previa Pública
                                </button>
                            </div>
                        </div>
                    `;
                    animalsGrid.appendChild(card);
                });
            }
        });
    </script>
</body>
</html>
